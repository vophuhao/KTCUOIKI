<!doctype html>
<html class="no-js" lang="" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title> Shop || James </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- favicon
    ============================================ -->
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">

    <!-- Google Fonts
    ============================================ -->
    <link href='https://fonts.googleapis.com/css?family=Norican' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
    <!-- Bootstrap CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <!-- Bootstrap CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <!-- owl.carousel CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/owl.theme.css">
    <link rel="stylesheet" href="/css/owl.transitions.css">
    <!-- jquery-ui CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <!-- meanmenu CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/meanmenu.min.css">
    <!-- nivoslider CSS
    ============================================ -->
    <link rel="stylesheet" href="/lib/css/nivo-slider.css">
    <link rel="stylesheet" href="/lib/css/preview.css">
    <!-- animate CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- magic CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/magic.css">
    <!-- normalize CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/normalize.css">
    <!-- main CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- style CSS
    ============================================ -->
    <link rel="stylesheet" href="/style.css">
    <!-- responsive CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/responsive.css">
    <!-- modernizr JS
    ============================================ -->
    <script src="/js/vendor/modernizr-2.8.3.min.js"></script>
    <style>
        .fa-heart {
            color: red; /* Trái tim đỏ khi yêu thích */
        }

        .fa-heart-o {
            color: #ccc; /* Trái tim xám khi chưa yêu thích */
        }
    </style>
</head>
<body>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->
<!-- header area start -->
<div th:include="~{fragments/user/header.html}"></div>
<!-- header area end -->
<!-- product items banner start -->
<div class="product-banner">
    <img src="/img/product/banner.jpg" alt="">
</div>
<!-- product items banner end -->
<!-- product main items area start -->
<div class="product-main-items">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="location">
                    <ul>
                        <li><a href="/" title="go to homepage">Home<span>/</span></a></li>
                        <li><strong> shop</strong></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3">
                <div class="product-sidebar">
                    <div class="sidebar-title">
                        <h2>Shopping Options</h2>
                    </div>
                    <div class="single-sidebar">
                        <div class="single-sidebar-title">
                            <h3>Category</h3>
                        </div>
                        <div class="single-sidebar-content">
                            <ul>
                                <li th:if="${#lists.isEmpty(cate)}">Chưa có danh mục</li>
                                <!-- Hiển thị khi danh sách trống -->
                                <li th:each="category : ${cate}">
                                    <a href="#tab15" class="category-link" th:attr="data-category-id=${category.id}">
                                        <span th:text="${category.type}">Category Name</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="single-sidebar price">
<!--                        <div class="single-sidebar-title">-->
<!--                            <h3>Price</h3>-->
<!--                        </div>-->
                        <div class="single-sidebar-content">
<!--                            <div class="price-range">-->
<!--                                <div class="price-filter">-->
<!--                                    <div id="slider-range"></div>-->
<!--                                    <div class="price-slider-amount">-->
<!--                                        <input type="text" id="amount" name="price" placeholder="Add Your Price"/>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
                            <form th:action="@{/product/search/all}" method="get">
                                <input type="hidden" name="category" id="selectedCategory" value="">
                                <input type="text" name="key" value="" placeholder="Search products">
                                <button type="submit"><span>search</span></button>
                            </form>
                        </div>
                    </div>
                    <div class="banner-left">
                        <a href="#">
                            <img src="/img/product/banner_left.jpg" alt="">
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="product-bar">
                    <ul class="nav product-navigation justify-content-center" role="tablist">
                        <li role="presentation" class="gird">
                            <a class="active" href="#gird" aria-controls="gird" role="tab" data-bs-toggle="tab">
                                        <span>
                                            <img class="primary" src="/img/product/grid-primary.png" alt="">
                                            <img class="secondary" src="/img/product/grid-secondary.png" alt="">
                                        </span>
                                Gird
                            </a>
                        </li>
                    </ul>
                    <!--
                    <div class="sort-by">
                        <label>Sort By</label>
                        <select name="sort">
                            <option value="#" selected >Position</option>
                            <option value="#">Name</option>
                            <option value="#">Price</option>
                        </select>
                        <a href="#" title="Set Descending Direction">
                            <img src="/img/product/i_asc_arrow.gif" alt="">
                        </a>
                    </div>-->
                    <div class="time-display limit-product">
                        <label>Current Time</label>
                        <span id="current-time">Loading...</span>
                    </div>
                </div>
                <div class="row" id="tab15">
                    <div class="product-content">
                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active fade show home2" id="gird">
                                <div id="productListContainer">
                                    <div class="row" id="productList">
                                        <div class="row">
                                            <h4 th:if="${alert} != null" th:text="${alert}"></h4>
                                            <div class="col-lg-4 col-md-6" th:each="product : ${products}">
                                                <div class="single-product">
                                                    <div class="level-pro-new">
                                                        <span>new</span>
                                                    </div>

                                                    <div class="product-img">
                                                        <a th:href="@{/product/details/{id}(id=${product.id})}">
                                                            <img th:src="${product.image}" alt="Image"
                                                                 class="primary-img">
                                                            <img src="/img/logo.png" alt="Image2" class="secondary-img">
                                                        </a>
                                                    </div>
                                                    <div class="product-name">
                                                        <a th:href="@{/product/details/{id}(id=${product.id})}"
                                                           th:title="${product.title}" th:text="${product.title}"></a>
                                                        <!--                                                            <p th:text="${product.description}"></p>-->
                                                    </div>
                                                    <div class="price-rating">
                                                        <span class="formatted-price" th:text="${product.price}"></span>
                                                        <!--                                                                <div class="ratings">-->
                                                        <!--                                                                    <i class="fa fa-star" th:each="star, iterStat : ${#numbers.sequence(1, product.rating)}"></i>-->
                                                        <!--                                                                    <i class="fa fa-star-half-o" th:if="${product.rating - #numbers.floor(product.rating) > 0}"></i>-->
                                                        <!--                                                                </div>-->
                                                        <div class="ratings">
                                                            <i class="fa fa-star"></i>
                                                            <i class="fa fa-star"></i>
                                                            <i class="fa fa-star"></i>
                                                            <i class="fa fa-star"></i>
                                                            <i class="fa fa-star"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Phân trang -->
                                            <div th:if="${!#lists.isEmpty(products)}">
                                                <ul class="pagination justify-content-center" style="margin-top: 50px">
                                                    <!-- Nút Previous -->
                                                    <li class="page-item"
                                                        th:classappend="${currentPage == 0 ? 'disabled' : ''}">
                                                        <a class="page-link"
                                                           th:href="@{/user/shop(page=${currentPage - 1}, size=6)}">Previous</a>
                                                    </li>

                                                    <!-- Các số trang -->
                                                    <li class="page-item"
                                                        th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                                        th:classappend="${i == currentPage ? 'active' : ''}">
                                                        <a class="page-link" th:href="@{/user/shop(page=${i}, size=6)}"
                                                           th:text="${i + 1}"></a>
                                                    </li>

                                                    <!-- Nút Next -->
                                                    <li class="page-item"
                                                        th:classappend="${currentPage == totalPages - 1 ? 'disabled' : ''}">
                                                        <a class="page-link"
                                                           th:href="@{/user/shop(page=${currentPage + 1}, size=6)}">Next</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- product main items area end -->

<!-- footer area start -->
<div th:include="~{fragments/web/footer.html}"></div>
<!-- footer area end -->
<!-- quickview product start -->
<div id="quickview-wrapper">
    <!-- Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="modal-product">
                        <div class="product-images">
                            <div class="main-image images">
                                <img alt="" src="/img/product/quick-view.jpg">
                            </div>
                        </div>

                        <div class="product-info">
                            <h1>Diam quis cursus</h1>
                            <div class="price-box">
                                <p class="price"><span class="special-price"><span class="amount">$132.00</span></span>
                                </p>
                            </div>
                            <a href="shop.html" class="see-all">See all features</a>
                            <div class="quick-add-to-cart">
                                <form method="post" class="cart">
                                    <div class="numbers-row">
                                        <input type="number" id="french-hens" value="3">
                                    </div>
                                    <button class="single_add_to_cart_button" type="submit">Add to cart</button>
                                </form>
                            </div>
                            <div class="quick-desc">
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam fringilla augue nec est
                                    tristique auctor. Donec non est at libero vulputate rutrum. Morbi ornare lectus quis
                                    justo gravida semper. Nulla tellus mi, vulputate adipiscing cursus eu, suscipit id
                                    nulla.</p>
                            </div>
                            <div class="share-post">
                                <div class="share-title">
                                    <h3>share this product</h3>
                                </div>
                                <div class="share-social">
                                    <ul>
                                        <li><a href="#"> <i class="fa fa-facebook"></i> </a></li>
                                        <li><a href="#"> <i class="fa fa-twitter"></i> </a></li>
                                        <li><a href="#"> <i class="fa fa-pinterest"></i> </a></li>
                                        <li><a href="#"> <i class="fa fa-google-plus"></i> </a></li>
                                        <li><a href="#"> <i class="fa fa-linkedin"></i> </a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- quickview product start -->
<!-- jquery
============================================ -->
<script src="/js/vendor/jquery-1.12.4.min.js"></script>
<!-- bootstrap JS
============================================ -->
<script src="/js/bootstrap.min.js"></script>
<!-- wow JS
============================================ -->
<script src="/js/wow.min.js"></script>
<!-- price-slider JS
============================================ -->
<script src="/js/jquery-price-slider.js"></script>
<!-- nivoslider JS
============================================ -->
<script src="/lib/js/jquery.nivo.slider.js"></script>
<script src="/lib/home.js"></script>
<!-- meanmenu JS
============================================ -->
<script src="/js/jquery.meanmenu.js"></script>
<!-- owl.carousel JS
============================================ -->
<script src="/js/owl.carousel.min.js"></script>
<!-- elevatezoom JS
============================================ -->
<script src="/js/jquery.elevatezoom.js"></script>
<!-- scrollUp JS
============================================ -->
<script src="/js/jquery.scrollUp.min.js"></script>
<!-- plugins JS
============================================ -->
<script src="/js/plugins.js"></script>
<!-- main JS
============================================ -->
<script src="/js/main.js"></script>
<script>
    $(document).ready(function () {
        // Bắt sự kiện khi nhấn vào liên kết "add-to-wishlist"
        $('.add-to-wishlist').click(function (e) {
            e.preventDefault(); // Ngăn chặn hành động mặc định của liên kết

            var productIdStr = $(this).data('product-id'); // Lấy productId từ thuộc tính data-product-id
            var productId = parseInt(productIdStr, 10); // Chuyển đổi productId sang số nguyên
            if (isNaN(productId) || productId <= 0) {
                alert('ID sản phẩm không hợp lệ');
                return;
            }

            var heartIcon = $(this).find('i'); // Lấy thẻ <i> chứa biểu tượng trái tim

            // Gửi yêu cầu AJAX đến server
            $.ajax({
                url: '/wishlist/toggle', // URL của endpoint thêm/xóa sản phẩm vào wishlist
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({productId: productId}), // Gửi productId dưới dạng JSON
                success: function (response) {
                    if (response === 'ADDED') {
                        // Nếu thêm thành công, thay đổi biểu tượng trái tim thành màu đỏ
                        heartIcon.removeClass('fa-heart-o').addClass('fa-heart');
                        heartIcon.css('color', 'red');
                    } else if (response === 'REMOVED') {
                        // Nếu bị xóa, đổi biểu tượng trái tim thành không màu
                        heartIcon.removeClass('fa-heart').addClass('fa-heart-o');
                        heartIcon.css('color', '');
                    } else if (response === 'LOGIN_REQUIRED') {
                        alert('Vui lòng đăng nhập để thêm sản phẩm vào wishlist');
                    } else if (response === 'ALREADY_EXISTS') {
                        alert('Sản phẩm đã có trong wishlist');
                    }
                },
                error: function () {
                    alert('Đã có lỗi xảy ra, vui lòng thử lại sau');
                }
            });
        });
    });
</script>
<script>
    // Hàm để cập nhật thời gian
    function updateTime() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        const timeString = `${hours}:${minutes}:${seconds}`;

        // Cập nhật thời gian hiển thị trong trang
        document.getElementById('current-time').textContent = timeString;
    }

    // Cập nhật thời gian mỗi giây
    setInterval(updateTime, 1000);

    // Cập nhật thời gian ngay khi trang được tải
    updateTime();
</script>

<script>
    $(document).ready(function () {
        // Hàm load sản phẩm theo danh mục
        function loadProducts(categoryId, page) {
            $.get("/category/" + categoryId, {page: page}, function (data) {
                console.log(data);  // Kiểm tra dữ liệu trả về
                $('#productListContainer').html(data);  // Đảm bảo rằng 'data' chứa phần HTML cần thiết
                bindPaginationLinks(categoryId);  // Gắn lại sự kiện cho các nút phân trang
            }).fail(function (error) {
                console.error("Error loading products:", error);
            });
        }

        // Gắn sự kiện click cho các danh mục
        $(document).on('click', '.category-link', function (e) {
            e.preventDefault();
            const categoryId = $(this).data('category-id');
            // Cập nhật giá trị category vào input ẩn
            $('#selectedCategory').val(categoryId);
            loadProducts(categoryId, 0); // Load trang đầu tiên
        });

        // Gắn sự kiện click cho các nút phân trang
        function bindPaginationLinks(categoryId) {
            $(document).on('click', '.page-link', function (e) {
                e.preventDefault();
                const page = $(this).data('page');
                if (!isNaN(page)) {
                    loadProducts(categoryId, page);
                } else {
                    console.error("Invalid page number");
                }
            });
        }
    });
</script>
<script>
    document.querySelectorAll('.formatted-price').forEach(function (priceElement) {
        var price = parseFloat(priceElement.textContent);
        priceElement.textContent = new Intl.NumberFormat().format(price);
    });
</script>
</body>
</html>
